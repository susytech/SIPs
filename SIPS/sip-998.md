---
sip: 998
title: SRC-998 Composable Non-Fungible Token Standard
author: Matt Lockyer <mattdlockyer@gmail.com>, Nick Mudge <nick@perfectabstractions.com>, Jordan Schalm <jordan.schalm@gmail.com>
discussions-to: https://github.com/susytech/SIPs/issues/998
type: Standards Track
category: SRC
status: Draft
created: 2018-07-07
requires: 721, 165
---

## Simple Summary
An extension of the [SRC721 standard](https://sips.superstring.ch/SIPS/sip-721) to enable SRC721 tokens to own other SRC721 tokens and SRC20 tokens.

An extension of the [SRC20](https://sips.superstring.ch/SIPS/sip-20) and [SRC223](https://github.com/susytech/SIPs/issues/223) standards to enable SRC20 and SRC223 tokens to be owned by SRC721 tokens.

This specification covers four different kinds of composable tokens:

1. [SRC998SRC721 top-down composable tokens that receive, hold and transfer SRC721 tokens](#src721-top-down-composable)
2. [SRC998SRC20 top-down composable tokens that receive, hold and transfer SRC20 tokens](#src20-top-down-composable)
3. [SRC998SRC721 bottom-up composable tokens that attach themselves to other SRC721 tokens.](#src721-bottom-up-composable)
4. [SRC998SRC20 bottom-up composable tokens that attach themselves to SRC721 tokens.](#src20-bottom-up-composable)

## Abstract

1. An SRC988SRC721 top-down composable is an SRC721 token with additional functionality for owning other SRC721 tokens. 
2. An SRC998SRC20 top-down composable is an SRC721 token with additional functionality for owning SRC20 tokens. 
3. An SRC998SRC721 bottom-up composable is an SRC721 token with additional functionality for being owned by an SRC721 token.
4. An SRC998SRC20 bottom-up composable is an SRC20 token with additional functionality for being owned by an SRC721 token.

A top-down composable contract stores and keeps track of child tokens for each of its tokens.

A bottom-up composable contract stores and keeps track of a parent token for each its tokens.

With composable tokens it is possible to compose lists or trees of SRC721 and SRC20 tokens connected by ownership. Any such structure will have a single owner address at the root of the structure that is the owner of the entire composition. The entire composition can be transferred with one transaction by changing the root owner.

Different composables, top-down and bottom-up, have their advantages and disadvantages which are explained in the [Rational section](#rationale). It is possible for a token to be one or more kinds of composable token.

A non-fungible token is SRC998 compliant and is an SRC998 Composable if it implements one or more of the following interfaces:

* SRC998SRC721TopDown
* SRC998SRC20TopDown
* SRC998SRC721BottomUp
* SRC998SRC20BottomUp

## Specification

### SRC721

SRC998SRC721 top-down, SRC998SRC20 top-down, and SRC998SRC721 bottom-up composable contracts must implement the [SRC721 interface](https://sips.superstring.ch/SIPS/sip-721).

### SRC20

SRC998SRC20 bottom-up composable contracts must implement the [SRC20 interface](https://sips.superstring.ch/SIPS/sip-20).

### SRC165

The [SRC165 standard](https://sips.superstring.ch/SIPS/sip-165) must be applied to each SRC998 interface that is used.

### Authentication

Authenticating whether a user or contract can execute some action works the same for both SRC998SRC721 top-down and SRC998SRC721 bottom-up composables.

A `rootOwner` refers to the owner address at the top of a tree of composables and SRC721 tokens. 

Authentication within any composable is done by finding the rootOwner and comparing it to `msg.sender`, the return result of `getApproved(tokenId)` and the return result of `isApprovedForAll(rootOwner, msg.sender)`. If a match is found then authentication passes, otherwise authentication fails and the contract throws.

Here is an example of authentication code:
```solidity
address rootOwner = address(rootOwnerOf(_tokenId));
require(rootOwner == msg.sender || 
  isApprovedForAll(rootOwner,msg.sender) ||
  getApproved(tokenId) == msg.sender;
```

The `approve(address _approved, uint256 _tokenId)` and `getApproved(uint256 _tokenId)` SRC721 functions are implemented specifically for the rootOwner. This enables a tree of composables to be transferred to a new rootOwner without worrying about which addresses have been approved in child composables, because any prior approves can only be used by the prior rootOwner.

Here are example implementations:
```solidity
function approve(address _approved, uint256 _tokenId) external {
  address rootOwner = address(rootOwnerOf(_tokenId));	
  require(rootOwner == msg.sender || isApprovedForAll(rootOwner,msg.sender));

  rootOwnerAndTokenIdToApprovedAddress[rootOwner][_tokenId] = _approved;
  emit Approval(rootOwner, _approved, _tokenId);
}

function getApproved(uint256 _tokenId) public view returns (address)  {
  address rootOwner = address(rootOwnerOf(_tokenId));
  return rootOwnerAndTokenIdToApprovedAddress[rootOwner][_tokenId];
}
```
### Traversal

The rootOwner of a composable is gotten by calling `rootOwnerOf(uint256 _tokenId)` or `rootOwnerOfChild(address _childContract, uint256 _childTokenId)`. These functions are used by top-down and bottom-up composables to traverse up the tree of composables and SRC721 tokens to find the rootOwner.

SRC998SRC721 top-down and bottom-up composables are interoperable with each other. It is possible for a top-down composable to own a bottom-up composable or for a top-down composable to own an SRC721 token that owns a bottom-up token. In any configuration calling `rootOwnerOf(uint256 _tokenID)` on a composable will return the root owner address at the top of the ownership tree.

It is important to get the traversal logic of `rootOwnerOf` right. The logic for `rootOwnerOf` is the same whether or not a composable is bottom-up or top-down or both.
Here is the logic:

```
Logic for rootOwnerOf(uint256 _tokenId)

If the token is a bottom-up composable and has a parent token then call rootOwnerOf for the parent token.
    If the call was successful then the returned address is the rootOwner.
    Otherwise call rootOwnerOfChild for the parent token.
        If the call was successful then the returned address is the rootOwner.
        Otherwise get the owner address of the token and that is the rootOwner.
Otherwise call rootOwnerOfChild for the token
    If the call was successful then the returned address is the rootOwner.
    Otherwise get the owner address of the token and that is the rootOwner.
```

Calling `rootOwnerOfChild` for a token means the following logic:
```solidity
// Logic for calling rootOwnerOfChild for a tokenId
address tokenOwner = ownerOf(tokenId);
address childContract = address(this);
bytes32 rootOwner = SRC998SRC721(tokenOwner).rootOwnerOfChild(childContract, tokenId);
```

But understand that the real call to `rootOwnerOfChild` should be made with assembly so that the code can check if the call failed and so that the `staticcall` opcode is used to ensure that no state is modified.

Tokens/contracts that implement the above authentication and traversal functionality are "composable aware".

### Composable Transfer Function Parameter Format

Composable functions that make transfers follow the same parameter format: **from:to:what**.

For example the ` getChild(address _from, uint256 _tokenId, address _childContract, uint256 _childTokenId)` composable function transfers an SRC721 token from an address to a top-down composable. The `_from` parameter is the **from**, the `_tokenId` parameter is the **to** and the `address _childContract, uint256 _childTokenId` parameters are the **what**.

Another example is the `safeTransferChild(uint256 _fromTokenId, address _to, address _childContract, uint256 _childTokenId)` function. The `_fromTokenId` is the **from**, the `_to` is the **to** and the `address _childContract, address _childTokenId` parameters are the **what**.

### transferFrom/safeTransferFrom Functions Do Not Transfer Tokens Owned By Tokens

In bottom-up and top-down composable contracts the `transferFrom` and `safeTransferFrom` functions must throw if they are called directly to transfer a token that is owned by another token.

The reason for this is that these functions do not explicitly specify which token owns a token to be transferred. [See the rational section for more information about this.](#explicit-transfer-parameters)

`transferFrom/safeTransferFrom` functions must be used to transfer tokens that are owned by an address.


### SRC721 Top-Down Composable

SRC721 top-down composables act as containers for SRC721 tokens. 

SRC721 top-down composables are SRC721 tokens that can receive, hold and transfer SRC721 tokens.

There are two ways to transfer a SRC721 token to a top-down composable:
1. Use the `function safeTransferFrom(address _from, address _to, uint256 _tokenId, bytes data)` function. The `_to` argument is the top-down composable contract address. The `bytes data` argument holds the integer value of the top-down composable tokenId that the SRC721 token is transferred to.
2. Call `approve` in the SRC721 token contract for the top-down composable contract. Then call `getChild` in the composable contract.

The first ways is for SRC721 contracts that have a `safeTransferFrom` function. The second way is for contracts that do not have this function such as cryptokitties.

Here is an example of transferring SRC721 token 3 from an address to top-down composable token 6:

```solidity
uint256 tokenId = 6;
bytes memory tokenIdBytes = new bytes(32);
assembly { mstore(add(tokenIdBytes, 32), tokenId) }
SRC721(contractAddress).safeTransferFrom(userAddress, composableAddress, 3, tokenIdBytes);
```

Every SRC721 top-down composable compliant contract must implement the SRC998SRC721TopDown interface.

The SRC998SRC721TopDownEnumerable and SRC998SRC20TopDownEnumerable interfaces are optional.

```solidity
pragma solidity ^0.4.24;

/// @title SRC998SRC721 Top-Down Composable Non-Fungible Token
/// @dev See https://github.com/susytech/SIPs/blob/master/SIPS/sip-998.md
///  Note: the SRC-165 identifier for this interface is 0x1efdf36a
interface SRC998SRC721TopDown {

  /// @dev This emits when a token receives a child token.
  /// @param _from The prior owner of the token.
  /// @param _toTokenId The token that receives the child token.
  event ReceivedChild(
    address indexed _from, 
    uint256 indexed _toTokenId, 
    address indexed _childContract, 
    uint256 _childTokenId
  );
  
  /// @dev This emits when a child token is transferred from a token to an address.
  /// @param _fromTokenId The parent token that the child token is being transferred from.
  /// @param _to The new owner address of the child token.
  event TransferChild(
    uint256 indexed _fromTokenId, 
    address indexed _to, 
    address indexed _childContract, 
    uint256 _childTokenId
  );

  /// @notice Get the root owner of tokenId.
  /// @param _tokenId The token to query for a root owner address
  /// @return rootOwner The root owner at the top of tree of tokens and SRC998 magic value.
  function rootOwnerOf(uint256 _tokenId) public view returns (bytes32 rootOwner);
  
  /// @notice Get the root owner of a child token.
  /// @param _childContract The contract address of the child token.
  /// @param _childTokenId The tokenId of the child.
  /// @return rootOwner The root owner at the top of tree of tokens and SRC998 magic value.
  function rootOwnerOfChild(
    address _childContract, 
    uint256 _childTokenId
  ) 
    public 
    view
    returns (bytes32 rootOwner);
  
  /// @notice Get the parent tokenId of a child token.
  /// @param _childContract The contract address of the child token.
  /// @param _childTokenId The tokenId of the child.
  /// @return parentTokenOwner The parent address of the parent token and SRC998 magic value
  /// @return parentTokenId The parent tokenId of _tokenId
  function ownerOfChild(
    address _childContract, 
    uint256 _childTokenId
  ) 
    external 
    view 
    returns (
      bytes32 parentTokenOwner, 
      uint256 parentTokenId
    );
  
  /// @notice A token receives a child token
  /// @param _operator The address that caused the transfer.
  /// @param _from The owner of the child token.
  /// @param _childTokenId The token that is being transferred to the parent.
  /// @param _data Up to the first 32 bytes contains an integer which is the receiving parent tokenId.  
  function onSRC721Received(
    address _operator, 
    address _from, 
    uint256 _childTokenId, 
    bytes _data
  ) 
    external 
    returns(bytes4);
    
  /// @notice Transfer child token from top-down composable to address.
  /// @param _fromTokenId The owning token to transfer from.
  /// @param _to The address that receives the child token
  /// @param _childContract The SRC721 contract of the child token.
  /// @param _childTokenId The tokenId of the token that is being transferred.
  function transferChild(
    uint256 _fromTokenId,
    address _to, 
    address _childContract, 
    uint256 _childTokenId
  ) 
    external;
  
  /// @notice Transfer child token from top-down composable to address.
  /// @param _fromTokenId The owning token to transfer from.
  /// @param _to The address that receives the child token
  /// @param _childContract The SRC721 contract of the child token.
  /// @param _childTokenId The tokenId of the token that is being transferred.
  function safeTransferChild(
    uint256 _fromTokenId,
    address _to, 
    address _childContract, 
    uint256 _childTokenId
  ) 
    external;
  
  /// @notice Transfer child token from top-down composable to address.
  /// @param _fromTokenId The owning token to transfer from.
  /// @param _to The address that receives the child token
  /// @param _childContract The SRC721 contract of the child token.
  /// @param _childTokenId The tokenId of the token that is being transferred.
  /// @param _data Additional data with no specified format
  function safeTransferChild(
    uint256 _fromTokenId,
    address _to, 
    address _childContract, 
    uint256 _childTokenId, 
    bytes _data
  ) 
    external;
  
  /// @notice Transfer bottom-up composable child token from top-down composable to other SRC721 token.
  /// @param _fromTokenId The owning token to transfer from.
  /// @param _toContract The SRC721 contract of the receiving token
  /// @param _toToken The receiving token  
  /// @param _childContract The bottom-up composable contract of the child token.
  /// @param _childTokenId The token that is being transferred.
  /// @param _data Additional data with no specified format
  function transferChildToParent(
    uint256 _fromTokenId, 
    address _toContract, 
    uint256 _toTokenId, 
    address _childContract, 
    uint256 _childTokenId, 
    bytes _data
  ) 
    external
  
  /// @notice Get a child token from an SRC721 contract.
  /// @param _from The address that owns the child token.
  /// @param _tokenId The token that becomes the parent owner
  /// @param _childContract The SRC721 contract of the child token
  /// @param _childTokenId The tokenId of the child token
  function getChild(
    address _from, 
    uint256 _tokenId, 
    address _childContract, 
    uint256 _childTokenId
  ) 
    external;
}
```

#### rootOwnerOf
```solidity
/// @notice Get the root owner of tokenId.
/// @param _tokenId The token to query for a root owner address
/// @return rootOwner The root owner at the top of tree of tokens and SRC998 magic value.
function rootOwnerOf(uint256 _tokenId) public view returns (bytes32 rootOwner);
```

This function traverses token owners until the the root owner address of `_tokenId` is found.

The first 4 bytes of rootOwner contain the SRC998 magic value `0xcd740db5`. The last 20 bytes contain the root owner address.

The magic value is returned because this function may be called on contracts when it is unknown if the contracts have a `rootOwnerOf` function. The magic value is used in such calls to ensure a valid return value is received.

If it is unknown whether a contract has the `rootOwnerOf` function then the first four bytes of the `rootOwner` return value must be compared to `0xcd740db5`. 

`0xcd740db5` is equal to: 
```solidity
this.rootOwnerOf.selector ^ this.rootOwnerOfChild.selector ^ 
this.tokenOwnerOf.selector ^ this.ownerOfChild.selector;
```

Here is an example of a value returned by `rootOwnerOf`.
`0xcd740db50000000000000000e5240103e1ff986a2c8ae6b6728ffe0d9a395c59`

#### rootOwnerOfChild
```solidity
/// @notice Get the root owner of a child token.
/// @param _childContract The contract address of the child token.
/// @param _childTokenId The tokenId of the child.
/// @return rootOwner The root owner at the top of tree of tokens and SRC998 magic value.
function rootOwnerOfChild(
  address _childContract, 
  uint256 _childTokenId
) 
  public 
  view 
  returns (bytes32 rootOwner);
```

This function traverses token owners until the the root owner address of the supplied child token is found.

The first 4 bytes of rootOwner contain the SRC998 magic value `0xcd740db5`. The last 20 bytes contain the root owner address.

The magic value is returned because this function may be called on contracts when it is unknown if the contracts have a `rootOwnerOf` function. The magic value is used in such calls to ensure a valid return value is received.

If it is unknown whether a contract has the `rootOwnerOfChild` function then the first four bytes of the `rootOwner` return value must be compared to `0xcd740db5`. 

#### ownerOfChild

```solidity
/// @notice Get the parent tokenId of a child token.
/// @param _childContract The contract address of the child token.
/// @param _childTokenId The tokenId of the child.
/// @return parentTokenOwner The parent address of the parent token and SRC998 magic value
/// @return parentTokenId The parent tokenId of _tokenId
function ownerOfChild(
  address _childContract, 
  uint256 _childTokenId
) 
  external 
  view 
  returns (
    address parentTokenOwner, 
    uint256 parentTokenId
  );
```

This function is used to get the parent tokenId of a child token and get the owner address of the parent token.

The first 4 bytes of parentTokenOwner contain the SRC998 magic value `0xcd740db5`. The last 20 bytes contain the parent token owner address.

The magic value is returned because this function may be called on contracts when it is unknown if the contracts have a `ownerOfChild` function. The magic value is used in such calls to ensure a valid return value is received.

If it is unknown whether a contract has the `ownerOfChild` function then the first four bytes of the `parentTokenOwner` return value must be compared to `0xcd740db5`. 

#### onSRC721Received
```solidity
/// @notice A token receives a child token
/// @param _operator The address that caused the transfer.
/// @param _from The prior owner of the child token.
/// @param _childTokenId The token that is being transferred to the parent.
/// @param _data Up to the first 32 bytes contains an integer which is the receiving parent tokenId.  
function onSRC721Received(
  address _operator, 
  address _from, 
  uint256 _childTokenId, 
  bytes _data
) 
  external 
  returns(bytes4);
```

This is a function defined in the SRC721 standard. This function is called in an SRC721 contract when `safeTransferFrom` is called. The `bytes _data` argument contains an integer value from 1 to 32 bytes long that is the parent tokenId that an SRC721 token is transferred to. 

The `onSRC721Received` function is how a top-down composable contract is notified that an SRC721 token has been transferred to it and what tokenId in the top-down composable is the parent tokenId.

The return value for `onSRC721Received` is the magic value `0x150b7a02` which is equal to `bytes4(keccak256(abi.encodePacked("onSRC721Received(address,address,uint256,bytes)")))`.

#### transferChild
```solidity
/// @notice Transfer child token from top-down composable to address.
/// @param _fromTokenId The owning token to transfer from.
/// @param _to The address that receives the child token
/// @param _childContract The SRC721 contract of the child token.
/// @param _childTokenId The tokenId of the token that is being transferred.
function transferChild(
  uint256 _fromTokenId,
  address _to, 
  address _childContract, 
  uint256 _childTokenId
) 
  external;
```

This function authenticates `msg.sender` and transfers a child token from a top-down composable to a different address. 

This function makes this call within it: 
```solidity
SRC721(_childContract).transferFrom(this, _to, _childTokenId);
```

#### safeTransferChild
```solidity
/// @notice Transfer child token from top-down composable to address.
/// @param _fromTokenId The owning token to transfer from.
/// @param _to The address that receives the child token
/// @param _childContract The SRC721 contract of the child token.
/// @param _childTokenId The tokenId of the token that is being transferred.
function safeTransferChild(
  uint256 _fromTokenId,
  address _to, 
  address _childContract, 
  uint256 _childTokenId
) 
  external;
```

This function authenticates `msg.sender` and transfers a child token from a top-down composable to a different address. 

This function makes this call within it: 
```solidity
SRC721(_childContract).safeTransferFrom(this, _to, _childTokenId);
```

#### safeTransferChild
```solidity
/// @notice Transfer child token from top-down composable to address or other top-down composable.
/// @param _fromTokenId The owning token to transfer from.
/// @param _to The address that receives the child token
/// @param _childContract The SRC721 contract of the child token.
/// @param _childTokenId The tokenId of the token that is being transferred.
/// @param _data Additional data with no specified format, can be used to specify tokenId to transfer to
function safeTransferChild(
  uint256 _fromTokenId,
  address _to, 
  address _childContract, 
  uint256 _childTokenId, 
  bytes _data
) 
  external;
```

This function authenticates `msg.sender` and transfers a child token from a top-down composable to a different address or to a different top-down composable.

A child token is transferred to a different top-down composable if the `_to` address is a top-down composable contract and `bytes _data` is supplied an integer representing the parent tokenId.

This function makes this call within it: 
```solidity
SRC721(_childContract).safeTransferFrom(this, _to, _childTokenId, _data);
```

#### transferChildToParent
```solidity
/// @notice Transfer bottom-up composable child token from top-down composable to other SRC721 token.
/// @param _fromTokenId The owning token to transfer from.
/// @param _toContract The SRC721 contract of the receiving token
/// @param _toToken The receiving token  
/// @param _childContract The bottom-up composable contract of the child token.
/// @param _childTokenId The token that is being transferred.
/// @param _data Additional data with no specified format
function transferChildToParent(
  uint256 _fromTokenId, 
  address _toContract, 
  uint256 _toTokenId, 
  address _childContract, 
  uint256 _childTokenId, 
  bytes _data
) 
  external
```

This function authenticates `msg.sender` and transfers a child bottom-up composable token from a top-down composable to a different SRC721 token. This function can only be used when the child token is a bottom-up composable token. It is designed to transfer a bottom-up composable token from a top-down composable to an SRC721 token (bottom-up style) in one transaction.

This function makes this call within it: 
```solidity
SRC998SRC721BottomUp(_childContract).transferToParent(
  address(this), 
  _toContract, 
  _toTokenId, 
  _childTokenId, 
  _data
);
```

#### getChild 
```solidity
/// @notice Get a child token from an SRC721 contract.
/// @param _from The address that owns the child token.
/// @param _tokenId The token that becomes the parent owner
/// @param _childContract The SRC721 contract of the child token
/// @param _childTokenId The tokenId of the child token
function getChild(
  address _from, 
  uint256 _tokenId, 
  address _childContract, 
  uint256 _childTokenId
) 
  external;
```

This function is used to transfer an SRC721 token when its contract does not have a `safeTransferChild(uint256 _fromTokenId, address _to, address _childContract, uint256 _childTokenId, bytes _data)` function.

A transfer with this function is done in two steps:
1. The owner of the SRC721 token calls `approve` or `setApprovalForAll` in the SRC721 contract for the top-down composable contract.
2. The owner of the SRC721 token calls `getChild` in the top-down composable contract for the SRC721 token.

The `getChild` function must authenticate that `msg.sender` is the owner of the SRC721 token in the SRC721 contract or is approved or an operator of the SRC721 token in the SRC721 contract.

#### SRC721 Top-Down Composable Enumeration
Optional interface for top-down composable enumeration:

```solidity
///  @dev The SRC-165 identifier for this interface is 0xa344afe4
interface SRC998SRC721TopDownEnumerable {

  /// @notice Get the total number of child contracts with tokens that are owned by tokenId.
  /// @param _tokenId The parent token of child tokens in child contracts
  /// @return uint256 The total number of child contracts with tokens owned by tokenId.
  function totalChildContracts(uint256 _tokenId) external view returns(uint256);
  
  /// @notice Get child contract by tokenId and index
  /// @param _tokenId The parent token of child tokens in child contract
  /// @param _index The index position of the child contract
  /// @return childContract The contract found at the tokenId and index.
  function childContractByIndex(
    uint256 _tokenId, 
    uint256 _index
  ) 
    external 
    view 
    returns (address childContract);
  
  /// @notice Get the total number of child tokens owned by tokenId that exist in a child contract.
  /// @param _tokenId The parent token of child tokens
  /// @param _childContract The child contract containing the child tokens
  /// @return uint256 The total number of child tokens found in child contract that are owned by tokenId.
  function totalChildTokens(
    uint256 _tokenId, 
    address _childContract
  ) 
    external 
    view 
    returns(uint256);
  
  /// @notice Get child token owned by tokenId, in child contract, at index position
  /// @param _tokenId The parent token of the child token
  /// @param _childContract The child contract of the child token
  /// @param _index The index position of the child token.
  /// @return childTokenId The child tokenId for the parent token, child token and index
  function childTokenByIndex(
    uint256 _tokenId, 
    address _childContract, 
    uint256 _index
  )
    external 
    view 
    returns (uint256 childTokenId);
}
```

### SRC20 Top-Down Composable

SRC20 top-down composables act as containers for SRC20 tokens.
  
SRC20 top-down composables are SRC721 tokens that can receive, hold and transfer SRC20 tokens.

There are two ways to transfer SRC20 tokens to an SRC20 Top-Down Composable:

1. Use the `transfer(address _to, uint256 _value, bytes _data);` function from the SRC223 contract. The `_to` argument is the SRC20 top-down composable contract address. The `_value` argument is how many SRC20 tokens to transfer. The `bytes` argument holds the integer value of the top-down composable tokenId that receives the SRC20 tokens.
2. Call `approve` in the SRC20 contract for the SRC20 top-down composable contract. Then call `getSRC20(address _from, uint256 _tokenId, address _src20Contract, uint256 _value)` from the SRC20 top-down composable contract.

The first way is for SRC20 contracts that support the SRC223 standard. The second way is for contracts that do not.

SRC20 top-down composables implement the following interface:
  
```solidity
/// @title SRC998SRC20 Top-Down Composable Non-Fungible Token
/// @dev See https://github.com/susytech/SIPs/blob/master/SIPS/sip-998.md
///  Note: the SRC-165 identifier for this interface is 0x7294ffed
interface SRC998SRC20TopDown {

  /// @dev This emits when a token receives SRC20 tokens.
  /// @param _from The prior owner of the token.
  /// @param _toTokenId The token that receives the SRC20 tokens.
  /// @param _src20Contract The SRC20 contract.
  /// @param _value The number of SRC20 tokens received.
  event ReceivedSRC20(
    address indexed _from, 
    uint256 indexed _toTokenId, 
    address indexed _src20Contract, 
    uint256 _value
  );
  
  /// @dev This emits when a token transfers SRC20 tokens.
  /// @param _tokenId The token that owned the SRC20 tokens.
  /// @param _to The address that receives the SRC20 tokens.
  /// @param _src20Contract The SRC20 contract.
  /// @param _value The number of SRC20 tokens transferred.
  event TransferSRC20(
    uint256 indexed _fromTokenId, 
    address indexed _to, 
    address indexed _src20Contract, 
    uint256 _value
  );

  /// @notice A token receives SRC20 tokens
  /// @param _from The prior owner of the SRC20 tokens
  /// @param _value The number of SRC20 tokens received
  /// @param _data Up to the first 32 bytes contains an integer which is the receiving tokenId.  
  function tokenFallback(address _from, uint256 _value, bytes _data) external;
  
  /// @notice Look up the balance of SRC20 tokens for a specific token and SRC20 contract
  /// @param _tokenId The token that owns the SRC20 tokens
  /// @param _src20Contract The SRC20 contract
  /// @return The number of SRC20 tokens owned by a token from an SRC20 contract
  function balanceOfSRC20(
    uint256 _tokenId, 
    address _src20Contract
  ) 
    external 
    view 
    returns(uint256);
  
  /// @notice Transfer SRC20 tokens to address
  /// @param _tokenId The token to transfer from
  /// @param _value The address to send the SRC20 tokens to
  /// @param _src20Contract The SRC20 contract
  /// @param _value The number of SRC20 tokens to transfer
  function transferSRC20(
    uint256 _tokenId, 
    address _to, 
    address _src20Contract, 
    uint256 _value
  ) 
    external;
  
  /// @notice Transfer SRC20 tokens to address or SRC20 top-down composable
  /// @param _tokenId The token to transfer from
  /// @param _value The address to send the SRC20 tokens to
  /// @param _src223Contract The SRC223 token contract
  /// @param _value The number of SRC20 tokens to transfer
  /// @param _data Additional data with no specified format, can be used to specify tokenId to transfer to
  function transferSRC223(
    uint256 _tokenId, 
    address _to, 
    address _src223Contract, 
    uint256 _value, 
    bytes _data
  )
    external;
  
  /// @notice Get SRC20 tokens from SRC20 contract.
  /// @param _from The current owner address of the SRC20 tokens that are being transferred.
  /// @param _tokenId The token to transfer the SRC20 tokens to.
  /// @param _src20Contract The SRC20 token contract
  /// @param _value The number of SRC20 tokens to transfer  
  function getSRC20(
    address _from, 
    uint256 _tokenId, 
    address _src20Contract, 
    uint256 _value
  ) 
    external;
}
```
#### tokenFallback
```solidity
/// @notice A token receives SRC20 tokens
/// @param _from The prior owner of the SRC20 tokens
/// @param _value The number of SRC20 tokens received
/// @param _data Up to the first 32 bytes contains an integer which is the receiving tokenId.  
function tokenFallback(address _from, uint256 _value, bytes _data) external;  
```

This function comes from the [SRC223 standard](https://github.com/susytech/SIPs/issues/223) which is an extension of the SRC20 standard. This function is called on the receiving contract from the sending contract when SRC20 tokens are transferred. This function is how the SRC20 top-down composable contract gets notified that one of its tokens received SRC20 tokens. Which token received SRC20 tokens is specified in the `_data` parameter.

#### balanceOfSRC20
```solidity
/// @notice Look up the balance of SRC20 tokens for a specific token and SRC20 contract
/// @param _tokenId The token that owns the SRC20 tokens
/// @param _src20Contract The SRC20 contract
/// @return The number of SRC20 tokens owned by a token from an SRC20 contract
function balanceOfSRC20(
  uint256 _tokenId, 
  address _src20Contract
) 
  external 
  view 
  returns(uint256);
```

Gets the balance of SRC20 tokens owned by a token from a specific SRC20 contract.

#### transferSRC20
```solidity
/// @notice Transfer SRC20 tokens to address
/// @param _tokenId The token to transfer from
/// @param _value The address to send the SRC20 tokens to
/// @param _src20Contract The SRC20 contract
/// @param _value The number of SRC20 tokens to transfer
function transferSRC20(
  uint256 _tokenId, 
  address _to, 
  address _src20Contract, 
  uint256 _value
)
  external;
```

This is used to transfer SRC20 tokens from a token to an address. This function calls `SRC20(_src20Contract).transfer(_to, _value)`;

This function must authenticate `msg.sender`.

#### transferSRC223
```solidity
  /// @notice Transfer SRC20 tokens to address or SRC20 top-down composable
  /// @param _tokenId The token to transfer from
  /// @param _value The address to send the SRC20 tokens to
  /// @param _src223Contract The SRC223 token contract
  /// @param _value The number of SRC20 tokens to transfer
  /// @param _data Additional data with no specified format, can be used to specify tokenId to transfer to
  function transferSRC223(
    uint256 _tokenId, 
    address _to, 
    address _src223Contract, 
    uint256 _value, 
    bytes _data
  )
    external;
```

This function is from the [SRC223 standard](https://github.com/susytech/SIPs/issues/223). It is used to transfer SRC20 tokens from a token to an address or to another token by putting an integer token value in the `_data` argument.

This function must authenticate `msg.sender`.

#### getSRC20
```solidity
/// @notice Get SRC20 tokens from SRC20 contract.
/// @param _from The current owner address of the SRC20 tokens that are being transferred.
/// @param _tokenId The token to transfer the SRC20 tokens to.
/// @param _src20Contract The SRC20 token contract
/// @param _value The number of SRC20 tokens to transfer  
function getSRC20(
  address _from, 
  uint256 _tokenId, 
  address _src20Contract, 
  uint256 _value
) 
  external;
```

This function is used to transfer SRC20 tokens to an SRC20 top-down composable when an SRC20 contract does not have a `transferSRC223(uint256 _tokenId, address _to, address _src223Contract, uint256 _value, bytes _data)` function.

Before this function can be used the SRC20 top-down composable contract address must be approved in the SRC20 contract to transfer the SRC20 tokens.

This function must authenticate that `msg.sender` equals `_from` or has been approved in the SRC20 contract.

#### SRC20 Top-Down Composable Enumeration
Optional interface for top-down composable enumeration:

```solidity
/// @dev The SRC-165 identifier for this interface is 0xc5fd96cd
interface SRC998SRC20TopDownEnumerable {
  
  /// @notice Get the number of SRC20 contracts that token owns SRC20 tokens from
  /// @param _tokenId The token that owns SRC20 tokens.
  /// @return uint256 The number of SRC20 contracts
  function totalSRC20Contracts(uint256 _tokenId) external view returns(uint256);
  
  /// @notice Get an SRC20 contract that token owns SRC20 tokens from by index
  /// @param _tokenId The token that owns SRC20 tokens.
  /// @param _index The index position of the SRC20 contract.
  /// @return address The SRC20 contract
  function src20ContractByIndex(
    uint256 _tokenId, 
    uint256 _index
  ) 
    external 
    view 
    returns(address);
}
```

### SRC721 Bottom-Up Composable

SRC721 bottom-up composables are SRC721 tokens that attach themselves to other SRC721 tokens.

SRC721 bottom-up composable contracts store the owning address of a token and the parent tokenId if any.

```solidity
/// @title SRC998SRC721 Bottom-Up Composable Non-Fungible Token
/// @dev See https://github.com/susytech/SIPs/blob/master/SIPS/sip-998.md
///  Note: the SRC-165 identifier for this interface is 0xa1b23002
interface SRC998SRC721BottomUp {

  /// @dev This emits when a token is transferred to an SRC721 token
  /// @param _toContract The contract the token is transferred to
  /// @param _toTokenId The token the token is transferred to
  /// @param _tokenId The token that is transferred  
  event TransferToParent(
    address indexed _toContract, 
    uint256 indexed _toTokenId, 
    uint256 _tokenId
  );
  
  /// @dev This emits when a token is transferred from an SRC721 token
  /// @param _fromContract The contract the token is transferred from
  /// @param _fromTokenId The token the token is transferred from
  /// @param _tokenId The token that is transferred  
  event TransferFromParent(
    address indexed _fromContract, 
    uint256 indexed _fromTokenId, 
    uint256 _tokenId
  );
  
  /// @notice Get the root owner of tokenId.
  /// @param _tokenId The token to query for a root owner address
  /// @return rootOwner The root owner at the top of tree of tokens and SRC998 magic value.
  function rootOwnerOf(uint256 _tokenId) external view returns (bytes32 rootOwner);

  /// @notice Get the owner addess and parent token (if there is one) of a token
  /// @param _tokenId The tokenId to query.
  /// @return tokenOwner The owner address of the token
  /// @return parentTokenId The parent owner of the token and SRC998 magic value
  /// @return isParent True if parentTokenId is a valid parent tokenId and false if there is no parent tokenId
  function tokenOwnerOf(
    uint256 _tokenId
  )
    external 
    view
    returns (
      bytes32 tokenOwner, 
      uint256 parentTokenId, 
      bool isParent
    );
 
  /// @notice Transfer token from owner address to a token
  /// @param _from The owner address
  /// @param _toContract The SRC721 contract of the receiving token
  /// @param _toToken The receiving token
  /// @param _data Additional data with no specified format
  function transferToParent(
    address _from, 
    address _toContract, 
    uint256 _toTokenId, 
    uint256 _tokenId, 
    bytes _data
  )
    external;
   
  /// @notice Transfer token from a token to an address
  /// @param _fromContract The address of the owning contract
  /// @param _fromTokenId The owning token
  /// @param _to The address the token is transferred to.
  /// @param _tokenId The token that is transferred
  /// @param _data Additional data with no specified format
  function transferFromParent(
    address _fromContract, 
    uint256 _fromTokenId, 
    address _to, 
    uint256 _tokenId, 
    bytes _data
  )
    external;
  
  /// @notice Transfer a token from a token to another token
  /// @param _fromContract The address of the owning contract
  /// @param _fromTokenId The owning token
  /// @param _toContract The SRC721 contract of the receiving token
  /// @param _toToken The receiving token
  /// @param _tokenId The token that is transferred
  /// @param _data Additional data with no specified format
  function transferAsChild(
    address _fromContract, 
    uint256 _fromTokenId, 
    address _toContract, 
    uint256 _toTokenId, 
    uint256 _tokenId, 
    bytes _data
  )
    external;
}
```

#### rootOwnerOf
```solidity
/// @notice Get the root owner of tokenId.
/// @param _tokenId The token to query for a root owner address
/// @return rootOwner The root owner at the top of tree of tokens and SRC998 magic value.
function rootOwnerOf(uint256 _tokenId) public view returns (bytes32 rootOwner);
```

This function traverses token owners until the the root owner address of `_tokenId` is found.

The first 4 bytes of rootOwner contain the SRC998 magic value `0xcd740db5`. The last 20 bytes contain the root owner address.

The magic value is returned because this function may be called on contracts when it is unknown if the contracts have a `rootOwnerOf` function. The magic value is used in such calls to ensure a valid return value is received.

If it is unknown whether a contract has the `rootOwnerOf` function then the first four bytes of the `rootOwner` return value must be compared to `0xcd740db5`. 

`0xcd740db5` is equal to: 
```solidity
this.rootOwnerOf.selector ^ this.rootOwnerOfChild.selector ^ 
this.tokenOwnerOf.selector ^ this.ownerOfChild.selector;
```

Here is an example of a value returned by `rootOwnerOf`.
`0xcd740db50000000000000000e5240103e1ff986a2c8ae6b6728ffe0d9a395c59`

#### tokenOwnerOf
```solidity
/// @notice Get the owner addess and parent token (if there is one) of a token
/// @param _tokenId The tokenId to query.
/// @return tokenOwner The owner address of the token and SRC998 magic value.
/// @return parentTokenId The parent owner of the token
/// @return isParent True if parentTokenId is a valid parent tokenId and false if there is no parent tokenId
function tokenOwnerOf(
  uint256 _tokenId
)
  external 
  view 
  returns (
    bytes32 tokenOwner, 
    uint256 parentTokenId, 
    bool isParent
  );
```

This function is used to get the owning address and parent tokenId of a token if there is one stored in the contract.

If `isParent` is true then `tokenOwner` is the owning SRC721 contract address and `parentTokenId` is a valid parent tokenId. If `isParent` is false then `tokenOwner` is a user address and `parentTokenId` does not contain a valid parent tokenId and must be ignored.

The first 4 bytes of `tokenOwner` contain the SRC998 magic value `0xcd740db5`. The last 20 bytes contain the token owner address.

The magic value is returned because this function may be called on contracts when it is unknown if the contracts have a `tokenOwnerOf` function. The magic value is used in such calls to ensure a valid return value is received.

If it is unknown whether a contract has the `rootOwnerOf` function then the first four bytes of the `tokenOwner` return value must be compared to `0xcd740db5`. 


#### transferToParent
```solidity
/// @notice Transfer token from owner address to a token
/// @param _from The owner address
/// @param _toContract The SRC721 contract of the receiving token
/// @param _toToken The receiving token
/// @param _data Additional data with no specified format
function transferToParent(
  address _from, 
  address _toContract, 
  uint256 _toTokenId, 
  uint256 _tokenId, 
  bytes _data
)
  external;
```

This function is used to transfer a token from an address to a token. `msg.sender` must be authenticated.

This function must check that `_toToken` exists in `_toContract` and throw if not.


#### transferFromParent
```solidity
/// @notice Transfer token from a token to an address
/// @param _fromContract The address of the owning contract
/// @param _fromTokenId The owning token
/// @param _to The address the token is transferred to.
/// @param _tokenId The token that is transferred
/// @param _data Additional data with no specified format
function transferFromParent(
  address _fromContract, 
  uint256 _fromTokenId, 
  address _to, 
  uint256 _tokenId, 
  bytes _data
)
  external;
```
This function is used to transfer a token from a token to an address. `msg.sender` must be authenticated.

This function must check that `_fromContract` and `_fromTokenId` own `_tokenId` and throw not.

#### transferAsChild
```solidity
/// @notice Transfer a token from a token to another token
/// @param _fromContract The address of the owning contract
/// @param _fromTokenId The owning token
/// @param _toContract The SRC721 contract of the receiving token
/// @param _toToken The receiving token
/// @param _tokenId The token that is transferred
/// @param _data Additional data with no specified format
function transferAsChild(
  address _fromContract, 
  uint256 _fromTokenId, 
  address _toContract, 
  uint256 _toTokenId, 
  uint256 _tokenId, 
  bytes _data
)
  external;
```

This function is used to transfer a token from a token to another token. `msg.sender` must be authenticated.

This function must check that `_toToken` exists in `_toContract` and throw if not.

This function must check that `_fromContract` and `_fromTokenId` own `_tokenId` and throw if not.

#### SRC721 Bottom-Up Composable Enumeration
Optional interface for bottom-up composable enumeration:

```solidity
/// @dev The SRC-165 identifier for this interface is 0x8318b539
interface SRC998SRC721BottomUpEnumerable {
  
  /// @notice Get the number of SRC721 tokens owned by parent token.
  /// @param _parentContract The contract the parent SRC721 token is from.
  /// @param _parentTokenId The parent tokenId that owns tokens
  //  @return uint256 The number of SRC721 tokens owned by parent token.
  function totalChildTokens(
    address _parentContract, 
    uint256 _parentTokenId
  ) 
    external 
    view 
    returns (uint256);
  
  /// @notice Get a child token by index
  /// @param _parentContract The contract the parent SRC721 token is from.
  /// @param _parentTokenId The parent tokenId that owns the token
  /// @param _index The index position of the child token
  /// @return uint256 The child tokenId owned by the parent token
  function childTokenByIndex(
    address _parentContract, 
    uint256 _parentTokenId, 
    uint256 _index
  ) 
    external 
    view 
    returns (uint256);
}
```

### SRC20 Bottom-Up Composable

SRC20 bottom-up composables are SRC20 tokens that attach themselves to SRC721 tokens, or are owned by a user address like standard SRC20 tokens.

When owned by an SRC721 token, SRC20 bottom-up composable contracts store the owning address of a token and the parent tokenId. SRC20 bottom-up composables add several methods to the SRC20 and SRC223 interfaces allowing for querying the balance of parent tokens, and transferring tokens to, from, and between parent tokens.

This functionality can be implemented by adding one additional mapping to track balances of tokens, in addition to the standard mapping for tracking user address balances.
```solidity
/// @dev This mapping tracks standard SRC20/SRC223 ownership, where an address owns
///  a particular amount of tokens.
mapping(address => uint) userBalances;

/// @dev This additional mapping tracks SRC998 ownership, where an SRC721 token owns
///  a particular amount of tokens. This tracks contractAddres => tokenId => balance
mapping(address => mapping(uint => uint)) nftBalances;
```

The complete interface is below.

```solidity
/// @title SRC998SRC20 Bottom-Up Composable Fungible Token
/// @dev See https://github.com/susytech/SIPs/blob/master/SIPS/sip-998.md
/// Note: The SRC-165 identifier for this interface is 0xffafa991
interface SRC998SRC20BottomUp {
  
  /// @dev This emits when a token is transferred to an SRC721 token
  /// @param _toContract The contract the token is transferred to
  /// @param _toTokenId The token the token is transferred to
  /// @param _amount The amount of tokens transferred
  event TransferToParent(
    address indexed _toContract, 
    uint256 indexed _toTokenId, 
    uint256 _amount
  );

  /// @dev This emits when a token is transferred from an SRC721 token
  /// @param _fromContract The contract the token is transferred from
  /// @param _fromTokenId The token the token is transferred from
  /// @param _amount The amount of tokens transferred
  event TransferFromParent(
    address indexed _fromContract, 
    uint256 indexed _fromTokenId, 
    uint256 _amount
  );

  /// @notice Get the balance of a non-fungible parent token
  /// @param _tokenContract The contract tracking the parent token
  /// @param _tokenId The ID of the parent token
  /// @return amount The balance of the token
  function balanceOfToken(
    address _tokenContract, 
    uint256 _tokenId
  )
    external
    view
    returns (uint256 amount);

  /// @notice Transfer tokens from owner address to a token
  /// @param _from The owner address
  /// @param _toContract The SRC721 contract of the receiving token
  /// @param _toToken The receiving token
  /// @param _amount The amount of tokens to transfer
  function transferToParent(
    address _from, 
    address _toContract, 
    uint256 _toTokenId, 
    uint256 _amount
  )
    external;

  /// @notice Transfer token from a token to an address
  /// @param _fromContract The address of the owning contract
  /// @param _fromTokenId The owning token
  /// @param _to The address the token is transferred to
  /// @param _amount The amount of tokens to transfer
  function transferFromParent(
    address _fromContract, 
    uint256 _fromTokenId, 
    address _to, 
    uint256 _amount
  )
    external;

  /// @notice Transfer token from a token to an address, using SRC223 semantics
  /// @param _fromContract The address of the owning contract
  /// @param _fromTokenId The owning token
  /// @param _to The address the token is transferred to
  /// @param _amount The amount of tokens to transfer
  /// @param _data Additional data with no specified format, can be used to specify the sender tokenId
  function transferFromParentSRC223(
    address _fromContract, 
    uint256 _fromTokenId, 
    address _to, 
    uint256 _amount, 
    bytes _data
  )
    external;

  /// @notice Transfer a token from a token to another token
  /// @param _fromContract The address of the owning contract
  /// @param _fromTokenId The owning token
  /// @param _toContract The SRC721 contract of the receiving token
  /// @param _toToken The receiving token
  /// @param _amount The amount tokens to transfer
  function transferAsChild(
    address _fromContract, 
    uint256 _fromTokenId, 
    address _toContract, 
    uint256 _toTokenId, 
    uint256 _amount
   )
    external;
}
```

#### balanceOfToken
```solidity
/// @notice Get the balance of a non-fungible parent token
/// @param _tokenContract The contract tracking the parent token
/// @param _tokenId The ID of the parent token
/// @return amount The balance of the token
function balanceOfToken(
  address _tokenContract, 
  uint256 _tokenId
)
  external
  view
  returns (uint256 amount);
```

This function returns the balance of a non-fungible token. It mirrors the standard SRC20 method `balanceOf`, but accepts the address of the parent token's contract, and the parent token's ID. This method behaves identically to `balanceOf`, but checks for ownership by SRC721 tokens rather than user addresses.

#### transferToParent
```solidity
/// @notice Transfer tokens from owner address to a token
/// @param _from The owner address
/// @param _toContract The SRC721 contract of the receiving token
/// @param _toToken The receiving token
/// @param _amount The amount of tokens to transfer
function transferToParent(
  address _from, 
  address _toContract, 
  uint256 _toTokenId, 
  uint256 _amount
)
  external;
```

This function transfers an amount of tokens from a user address to an SRC721 token. This function MUST ensure that the recipient contract implements SRC721 using the SRC165 `supportsInterface` function. This function SHOULD ensure that the recipient token actually exists, by calling `ownerOf` on the recipient token's contract, and ensuring it neither throws nor returns the zero address. This function MUST emit the `TransferToParent` event upon a successful transfer (in addition to the standard SRC20 `Transfer` event!). This function MUST throw if the `_from` account balance does not have enough tokens to spend.

#### transferFromParent
```solidity
/// @notice Transfer token from a token to an address
/// @param _fromContract The address of the owning contract
/// @param _fromTokenId The owning token
/// @param _to The address the token is transferred to
/// @param _amount The amount of tokens to transfer
function transferFromParent(
  address _fromContract, 
  uint256 _fromTokenId, 
  address _to, 
  uint256 _amount
)
  external;
```

This function transfers an amount of tokens from an SRC721 token to an address. This function MUST emit the `TransferFromParent` event upon a successful transfer (in addition to the standard SRC20 `Transfer` event!). This function MUST throw if the balance of the sender SRC721 token is less than the `_amount` specified. This function MUST verify that the `msg.sender` owns the sender SRC721 token, and MUST throw otherwise.

#### transferFromParentSRC223
```solidity
/// @notice Transfer token from a token to an address, using SRC223 semantics
/// @param _fromContract The address of the owning contract
/// @param _fromTokenId The owning token
/// @param _to The address the token is transferred to
/// @param _amount The amount of tokens to transfer
/// @param _data Additional data with no specified format, can be used to specify the sender tokenId
function transferFromParentSRC223(
  address _fromContract, 
  uint256 _fromTokenId, 
  address _to, 
  uint256 _amount, 
  bytes _data
)
  external;
```

This function transfers an amount of tokens from an SRC721 token to an address. This function has identical requirements to `transferFromParent`, except that it additionally MUST invoke `tokenFallback` on the recipient address, if the address is a contract, as specified by SRC223.

#### transferAsChild
```solidity
/// @notice Transfer a token from a token to another token
/// @param _fromContract The address of the owning contract
/// @param _fromTokenId The owning token
/// @param _toContract The SRC721 contract of the receiving token
/// @param _toToken The receiving token
/// @param _amount The amount tokens to transfer
function transferAsChild(
  address _fromContract, 
  uint256 _fromTokenId, 
  address _toContract, 
  uint256 _toTokenId, 
  uint256 _amount
)
  external;
```

This function transfers an amount of tokens from an SRC721 token to another SRC721 token. This function MUST emit BOTH the `TransferFromParent` and `TransferToParent` events (in addition to the standard SRC20 `Transfer` event!). This function MUST throw if the balance of the sender SRC721 token is less than the `_amount` specified. This function MUST verify that the `msg.sender` owns the sender SRC721 token, and MUST throw otherwise. This function MUST ensure that the recipient contract implements SRC721 using the SRC165 `supportsInterface` function. This function SHOULD ensure that the recipient token actually exists, by calling `ownerOf` on the recipient token's contract, and ensuring it neither throws nor returns the zero address.

### Notes
For backwards-compatibility, implementations MUST emit the standard SRC20 `Transfer` event when a transfer occurs, regardless of whether the sender and recipient are addresses or SRC721 tokens. In the case that either sender or recipient are tokens, the corresponding parameter in the `Transfer` event SHOULD be the contract address of the token.

Implementations MUST implement all SRC20 and SRC223 functions in addition to the functions specified in this interface.

## Rationale
Two different kinds of composable (top-down and bottom-up) exist to handle different use cases. A regular SRC721 token cannot own a top-down composable, but it can own a bottom-up composable. A bottom-up composable cannot own a regular SRC721 but a top-down composable can own a regular SRC721 token. Having multiple kinds of composables enable different token ownership possibilities.

### Which Kind of Composable To Use?

If you want to transfer regular SRC721 tokens to non-fungible tokens, then use top-down composables.

If you want to transfer non-fungible tokens to regular SRC721 tokens then use bottom-up composables.

### Explicit Transfer Parameters

Every SRC998 transfer function includes explicit parameters to specify the prior owner and the new owner of a token. Explicitly providing **from** and **to** is done intentionally to avoid situations where tokens are transferred in unintended ways.

Here is an example of what could occur if **from** was not explicitly provided in transfer functions:
> An exchange contract is an approved operator in a specific composable contract for user A, user B and user C.
>
> User A transfers token 1 to user B. At the same time the exchange contract transfers token 1 to user C (with the implicit intention to transfer from user A). User B gets token 1 for a minute before it gets incorrectly transferred to user C. The second transfer should have failed but it didn't because no explicit **from** was provided to ensure that token 1 came from user A.


### Additional Reading Material
[Introducing Crypto Composables](https://medium.com/coinmonks/introducing-crypto-composables-ee5701fde217)

[Crypto Composables — Building Blocks and Applications](https://medium.com/coinmonks/introducing-crypto-composables-ee5701fde217)

[Top-Down and Bottom-Up Composables, What's the Difference and Which One Should You Use?](https://hackernoon.com/top-down-and-bottom-up-composables-whats-the-difference-and-which-one-should-you-use-db939f6acf1d)

Join the discussion about composables in the [NFTy Magician's Discord](https://discord.gg/8cuuj2Y).

## Backwards Compatibility
Composables are designed to work with SRC721, SRC223 and SRC20 tokens.

Some older SRC721 contracts do not have a `safeTransferFrom` function. The `getChild` function can still be used to transfer a token to an SRC721 top-down composable.

If an SRC20 contract does not have the SRC223 function `transfer(address _to, uint _value, bytes _data)` then the `getSRC20` function can still be used to transfer SRC20 tokens to an SRC20 top-down composable.


## Implementations

An implementation can be found here: https://github.com/mattlockyer/composables-998


## Copyright

Copyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/).



